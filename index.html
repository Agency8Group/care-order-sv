<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ï°∞Î¶¨Ïõê Ï£ºÎ¨∏ ÏãúÏä§ÌÖú</title>
        <link
            rel="icon"
            href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>"
        />
        <!-- Î≥¥Ïïà Í∞ïÌôî: API ÏÑ§Ï†ï ÌååÏùº Î°úÎìú -->
        <script src="proxy-config.js"></script>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                background: #ffffff;
                padding: 20px;
                min-height: 100vh;
                position: relative;
                color: #000000;
            }

            .container {
                max-width: 1400px;
                margin: 0 auto;
                background: white;
                border-radius: 12px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
                overflow: hidden;
                border: 1px solid #e5e5e5;
            }

            /* Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÏö© Ïª¥Ìå©Ìä∏ Ïª®ÌÖåÏù¥ÎÑà */
            .container.login-mode {
                max-width: 500px;
                margin: 0 auto;
                background: transparent;
                box-shadow: none;
                overflow: visible;
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                border: none;
            }

            .container.login-mode .header {
                display: none;
            }

            .header {
                background: #000000;
                color: white;
                padding: 24px;
                text-align: center;
            }

            .header h1 {
                font-size: 2rem;
                font-weight: 600;
                letter-spacing: -0.025em;
            }

            .section {
                padding: 24px;
                border-bottom: 1px solid #e5e5e5;
            }

            .section:last-child {
                border-bottom: none;
            }

            /* Ïª¥Ìå©Ìä∏ Î°úÍ∑∏Ïù∏ ÏÑπÏÖò */
            #loginSection {
                max-width: 400px;
                margin: 50px auto;
                padding: 32px;
                background: white;
                border-radius: 12px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 10px 15px rgba(0, 0, 0, 0.1);
                text-align: center;
                border: 1px solid #e5e5e5;
                position: relative;
            }

            /* Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÏö© Ìó§Îçî */
            .login-header {
                background: #000000;
                color: white;
                padding: 20px;
                border-radius: 12px 12px 0 0;
                margin: -32px -32px 24px -32px;
                text-align: center;
            }

            .login-header h1 {
                font-size: 1.5rem;
                font-weight: 600;
                letter-spacing: -0.025em;
                margin: 0;
            }

            #loginSection h2 {
                margin-bottom: 24px;
                color: #000000;
                font-size: 1.5rem;
                font-weight: 600;
            }

            .form-group {
                margin-bottom: 20px;
                text-align: left;
            }

            .form-group label {
                display: block;
                margin-bottom: 8px;
                font-weight: 500;
                color: #000000;
                font-size: 0.875rem;
            }

            .form-group input,
            .form-group select {
                width: 100%;
                padding: 12px 16px;
                border: 1px solid #e5e5e5;
                border-radius: 8px;
                font-size: 1rem;
                transition: all 0.2s ease;
                background: white;
                color: #000000;
            }

            .form-group input:focus {
                outline: none;
                border-color: #000000;
                box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
            }

            #loginBtn {
                width: 100%;
                padding: 12px 16px;
                font-size: 1rem;
                font-weight: 500;
                border-radius: 8px;
                margin-top: 16px;
                background: #000000;
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
                border: none;
                color: white;
                transition: all 0.2s ease;
            }

            #loginBtn:hover {
                background: #333333;
                transform: translateY(-1px);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            .btn {
                background: #000000;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.875rem;
                margin-right: 8px;
                transition: all 0.2s ease;
                font-weight: 500;
            }

            .btn:hover {
                background: #333333;
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .btn:disabled {
                background: #cccccc;
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .btn-success {
                background: #000000;
                width: 100%;
                margin: 8px 0;
            }

            .btn-success:hover {
                background: #333333;
            }

            .btn-danger {
                background: #000000;
                width: 100%;
                margin: 8px 0;
            }

            .btn-danger:hover {
                background: #333333;
            }

            .message {
                padding: 12px 16px;
                margin: 12px 0;
                border-radius: 8px;
                border: 1px solid;
                font-weight: 500;
            }

            .message.success {
                background: #f8f8f8;
                color: #000000;
                border-color: #e5e5e5;
            }

            .message.error {
                background: #f8f8f8;
                color: #000000;
                border-color: #e5e5e5;
            }

            .message.info {
                background: #f8f8f8;
                color: #000000;
                border-color: #e5e5e5;
            }

            /* Ï§ëÏïô ÏïåÎ¶º Î™®Îã¨ Ïä§ÌÉÄÏùº */
            .notification-modal {
                display: none;
                position: fixed;
                z-index: 2000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                animation: fadeIn 0.2s ease;
            }

            .notification-content {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: white;
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.04);
                text-align: center;
                min-width: 320px;
                max-width: 400px;
                animation: slideIn 0.2s ease;
                border: 1px solid #e5e5e5;
            }

            .notification-icon {
                font-size: 48px;
                margin-bottom: 16px;
            }

            .notification-title {
                font-size: 1.125rem;
                font-weight: 600;
                margin-bottom: 12px;
                color: #000000;
            }

            .notification-message {
                font-size: 0.875rem;
                color: #666666;
                line-height: 1.5;
                margin-bottom: 20px;
            }

            .notification-close {
                background: #000000;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.875rem;
                font-weight: 500;
                transition: all 0.2s ease;
            }

            .notification-close:hover {
                background: #333333;
            }

            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translate(-50%, -60%);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%);
                }
            }

            .budget-info {
                background: #000000;
                color: white;
                padding: 20px;
                border-radius: 12px;
                margin: 0;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            }

            .budget-info h3 {
                margin-bottom: 16px;
                color: white;
                text-align: center;
                font-size: 1.125rem;
                font-weight: 600;
            }

            .budget-item {
                display: flex;
                justify-content: space-between;
                margin: 8px 0;
                padding: 8px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                font-weight: 500;
            }

            .budget-item:last-child {
                border-bottom: none;
                font-weight: 600;
                font-size: 1rem;
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .product-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
                margin: 16px 0;
            }

            .product-card {
                border: 1px solid #e5e5e5;
                border-radius: 12px;
                padding: 16px;
                text-align: center;
                background: white;
                transition: all 0.2s ease;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                display: flex;
                flex-direction: column;
                height: 350px;
                position: relative;
            }

            .product-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 10px 15px rgba(0, 0, 0, 0.1);
                border-color: #000000;
            }

            /* ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ Ïä§ÌÉÄÏùº */
            .product-image {
                width: 100%;
                height: 140px;
                background: #f8f8f8;
                border-radius: 8px;
                margin-bottom: 16px;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                position: relative;
            }

            .product-image img {
                width: 100%;
                height: 100%;
                object-fit: contain;
                border-radius: 8px;
                transition: transform 0.2s ease;
                background: white;
            }

            .product-image-placeholder {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: #cccccc;
                font-size: 24px;
                height: 100%;
            }

            .product-image-placeholder span {
                font-size: 12px;
                margin-top: 4px;
                color: #999999;
                font-weight: 500;
            }

            /* Ïù¥ÎØ∏ÏßÄ Î°úÎî© ÏÉÅÌÉú */
            .product-image.loading {
                background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
                background-size: 200% 100%;
                animation: loading 1.5s infinite;
            }

            /* Ïù¥ÎØ∏ÏßÄ ÌôïÎåÄ Ìö®Í≥º */
            .product-image:hover img {
                transform: scale(1.05);
                transition: transform 0.2s ease;
            }

            .product-card h4 {
                margin-bottom: 12px;
                color: #000000;
                font-size: 0.875rem;
                line-height: 1.4;
                height: 40px;
                overflow: hidden;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                flex-grow: 1;
                font-weight: 500;
            }

            .product-card .price {
                font-size: 1rem;
                font-weight: 600;
                color: #000000;
                margin-bottom: 4px;
            }

            .product-card .unit {
                font-size: 0.75rem;
                color: #666666;
                margin-bottom: 12px;
                font-style: italic;
            }

            .quantity-control {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                margin-top: auto;
            }

            .quantity-control button {
                background: #000000;
                color: white;
                border: none;
                border-radius: 50%;
                width: 28px;
                height: 28px;
                cursor: pointer;
                font-size: 14px;
                font-weight: 600;
                transition: all 0.2s ease;
            }

            .quantity-control button:hover {
                background: #333333;
                transform: scale(1.05);
            }

            .quantity-control input {
                width: 50px;
                text-align: center;
                border: 1px solid #e5e5e5;
                border-radius: 6px;
                padding: 6px;
                font-size: 0.875rem;
                font-weight: 500;
                color: #000000;
                background: white;
                transition: all 0.2s ease;
            }

            .quantity-control input:focus {
                outline: none;
                border-color: #000000;
                box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
            }

            .cart {
                background: #f8f8f8;
                padding: 20px;
                border-radius: 12px;
                margin: 0;
                border: 1px solid #e5e5e5;
            }

            .cart h3 {
                margin-bottom: 12px;
                color: #000000;
                font-size: 1rem;
                font-weight: 600;
            }

            .cart-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid #e5e5e5;
                font-weight: 500;
            }

            .cart-item:last-child {
                border-bottom: none;
            }

            .cart-total {
                font-weight: 600;
                font-size: 1.125rem;
                color: #000000;
                text-align: right;
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px solid #e5e5e5;
            }

            .modal {
                display: none;
                position: fixed;
                z-index: 1000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
            }

            .modal-content {
                background-color: white;
                margin: 15% auto;
                padding: 24px;
                border-radius: 12px;
                width: 90%;
                max-width: 400px;
                box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
                border: 1px solid #e5e5e5;
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
            }

            .close {
                color: #666666;
                font-size: 24px;
                font-weight: bold;
                cursor: pointer;
                transition: color 0.2s ease;
            }

            .close:hover {
                color: #000000;
            }

            .hidden {
                display: none;
            }

            /* ÏïÑÏΩîÎîîÏñ∏ Ïä§ÌÉÄÏùº */
            .accordion-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                cursor: pointer;
                padding: 12px 0;
                border-bottom: 1px solid #e5e5e5;
                transition: all 0.2s ease;
            }

            .accordion-header:hover {
                background: #f8f8f8;
                border-radius: 8px;
                padding: 12px;
                margin: 0 -12px;
            }

            .accordion-header h2 {
                margin: 0;
                color: #000000;
                font-weight: 600;
                font-size: 1rem;
            }

            .accordion-icon {
                font-size: 16px;
                color: #000000;
                transition: transform 0.2s ease;
                font-weight: 600;
            }

            .accordion-content {
                padding: 16px 0;
                border-top: 1px solid #e5e5e5;
            }

            /* Î°úÎî© ÏÉÅÌÉú Ïä§ÌÉÄÏùº */
            .loading-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9999;
                justify-content: center;
                align-items: center;
            }

            .loading-spinner {
                width: 40px;
                height: 40px;
                border: 4px solid #f3f4f6;
                border-top: 4px solid #000000;
                border-radius: 50%;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .loading-content {
                background: white;
                padding: 24px;
                border-radius: 12px;
                text-align: center;
                box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
                border: 1px solid #e5e5e5;
            }

            .loading-text {
                margin-top: 16px;
                color: #000000;
                font-size: 1rem;
                font-weight: 500;
            }

            .loading-progress {
                width: 100%;
                height: 6px;
                background: #e5e5e5;
                border-radius: 3px;
                margin-top: 16px;
                overflow: hidden;
            }

            .loading-progress-bar {
                height: 100%;
                background: #000000;
                border-radius: 3px;
                transition: width 0.3s ease;
                width: 0%;
            }

            .btn-loading {
                position: relative;
                pointer-events: none;
            }

            .btn-loading::after {
                content: "";
                position: absolute;
                width: 16px;
                height: 16px;
                margin: auto;
                border: 2px solid transparent;
                border-top-color: #ffffff;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
            }

            .skeleton-loading {
                background: linear-gradient(
                    90deg,
                    #f0f0f0 25%,
                    #e0e0e0 50%,
                    #f0f0f0 75%
                );
                background-size: 200% 100%;
                animation: loading 1.5s infinite;
            }

            @keyframes loading {
                0% {
                    background-position: 200% 0;
                }
                100% {
                    background-position: -200% 0;
                }
            }

            .skeleton-text {
                height: 20px;
                margin: 10px 0;
                border-radius: 4px;
            }

            .skeleton-card {
                height: 120px;
                border-radius: 8px;
                margin: 10px 0;
            }

            /* Îã®Í≥ÑÎ≥Ñ ÏßÑÌñâ ÏÉÅÌÉú */
            .progress-steps {
                display: flex;
                justify-content: space-between;
                margin: 20px 0;
                position: relative;
            }

            .progress-step {
                display: flex;
                flex-direction: column;
                align-items: center;
                position: relative;
                z-index: 2;
            }

            .step-circle {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: #e5e5e5;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                color: #666666;
                margin-bottom: 6px;
                transition: all 0.2s ease;
                font-size: 0.875rem;
            }

            .step-circle.active {
                background: #000000;
                color: white;
            }

            .step-circle.completed {
                background: #333333;
                color: white;
            }

            .step-label {
                font-size: 0.75rem;
                color: #666666;
                text-align: center;
                max-width: 80px;
                font-weight: 500;
            }

            .progress-line {
                position: absolute;
                top: 16px;
                left: 16px;
                right: 16px;
                height: 2px;
                background: #e5e5e5;
                z-index: 1;
            }

            .progress-fill {
                height: 100%;
                background: #000000;
                transition: width 0.3s ease;
                width: 0%;
            }

            /* Î©îÏù∏ Î†àÏù¥ÏïÑÏõÉ Ïä§ÌÉÄÏùº */
            .main-layout {
                display: flex;
                gap: 20px;
                min-height: 600px;
            }

            .left-panel {
                flex: 2;
                background: #f8f8f8;
                border-radius: 12px;
                padding: 20px;
            }

            .right-panel {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 16px;
                min-width: 300px;
            }

            .right-panel .section {
                background: white;
                border-radius: 12px;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
                margin-bottom: 0;
                border: 1px solid #e5e5e5;
            }

            /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
            @media (max-width: 768px) {
                .main-layout {
                    flex-direction: column;
                    gap: 16px;
                }

                .left-panel,
                .right-panel {
                    flex: none;
                    width: 100%;
                }

                .right-panel {
                    min-width: auto;
                }

                .container {
                    max-width: 100%;
                    margin: 0;
                    border-radius: 0;
                }

                body {
                    padding: 10px;
                }

                .product-grid {
                    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
                    gap: 12px;
                }

                .product-card {
                    height: 320px;
                    padding: 12px;
                }

                .product-image {
                    height: 120px;
                }

                .product-card h4 {
                    font-size: 0.8rem;
                    height: 36px;
                }

                .header h1 {
                    font-size: 1.5rem;
                }
            }

            /* ÌÉúÎ∏îÎ¶ø Î∞òÏùëÌòï */
            @media (min-width: 769px) and (max-width: 1024px) {
                .main-layout {
                    gap: 16px;
                }

                .left-panel {
                    flex: 1.5;
                }

                .right-panel {
                    flex: 1;
                    min-width: 280px;
                }
            }
        </style>
    </head>
    <body>
        <!-- Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loadingText">Ï≤òÎ¶¨ Ï§ë...</div>
                <div class="loading-progress">
                    <div
                        class="loading-progress-bar"
                        id="loadingProgressBar"
                    ></div>
                </div>
                <!-- Îã®Í≥ÑÎ≥Ñ ÏßÑÌñâ ÏÉÅÌÉú -->
                <div
                    class="progress-steps"
                    id="progressSteps"
                    style="display: none"
                >
                    <div class="progress-line">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-step">
                        <div class="step-circle" id="step1">1</div>
                        <div class="step-label">ÏöîÏ≤≠ Ï†ÑÏÜ°</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-circle" id="step2">2</div>
                        <div class="step-label">ÏÑúÎ≤Ñ Ï≤òÎ¶¨</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-circle" id="step3">3</div>
                        <div class="step-label">Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-circle" id="step4">4</div>
                        <div class="step-label">ÏôÑÎ£å</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ï§ëÏïô ÏïåÎ¶º Î™®Îã¨ -->
        <div id="notificationModal" class="notification-modal">
            <div class="notification-content">
                <div class="notification-icon" id="notificationIcon">‚ÑπÔ∏è</div>
                <div class="notification-title" id="notificationTitle">ÏïåÎ¶º</div>
                <div class="notification-message" id="notificationMessage">Î©îÏãúÏßÄÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§.</div>
                <button class="notification-close" onclick="closeNotification()">ÌôïÏù∏</button>
            </div>
        </div>

        <div class="container">
            <!-- Ìó§Îçî -->
            <div class="header">
                <h1>Ï°∞Î¶¨Ïõê Ï£ºÎ¨∏ ÏãúÏä§ÌÖú</h1>
            </div>

            <!-- Ïª¥Ìå©Ìä∏ Î°úÍ∑∏Ïù∏ ÏÑπÏÖò -->
            <div id="loginSection" class="section">
                <div class="login-header">
                    <h1>Ï°∞Î¶¨Ïõê Ï£ºÎ¨∏ ÏãúÏä§ÌÖú</h1>
                </div>
                <h2>Î°úÍ∑∏Ïù∏</h2>
                <form id="loginForm" onsubmit="handleLogin(); return false;">
                    <div class="form-group">
                        <label for="userId">Ï°∞Î¶¨Ïõê ID</label>
                        <input
                            type="text"
                            id="userId"
                            placeholder="IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                            required
                        />
                    </div>
                    <div class="form-group">
                        <label for="pin">PIN Î≤àÌò∏</label>
                        <input
                            type="password"
                            id="pin"
                            placeholder="PINÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                            required
                        />
                    </div>
                    <button type="submit" id="loginBtn" class="btn">
                        Î°úÍ∑∏Ïù∏
                    </button>
                </form>
                <div id="loginMessage"></div>
                <div id="securityStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; font-size: 12px; text-align: center; color: #666; display: none;">
                    <!-- Î≥¥Ïïà ÏÉÅÌÉúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                </div>
            </div>

            <!-- Î©îÏù∏ Ï£ºÎ¨∏ ÏÑπÏÖò (Î°úÍ∑∏Ïù∏ ÌõÑ ÌëúÏãú) -->
            <div id="mainSection" class="section hidden">
                <!-- Ï¢åÏö∞ Î∂ÑÎ¶¨ Î†àÏù¥ÏïÑÏõÉ -->
                <div class="main-layout">
                    <!-- Ï¢åÏ∏°: ÏÉÅÌíà Î™©Î°ù -->
                    <div class="left-panel">
                        <div class="section">
                            <h2>üõçÔ∏è ÏÉÅÌíà ÏÑ†ÌÉù</h2>
                            <div class="product-grid" id="productGrid">
                                <!-- ÏÉÅÌíàÎì§Ïù¥ ÎèôÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎê©ÎãàÎã§ -->
                            </div>
                        </div>
                    </div>

                    <!-- Ïö∞Ï∏°: ÏòàÏÇ∞Ï†ïÎ≥¥, Ïû•Î∞îÍµ¨Îãà, Ï£ºÎ¨∏ÌïòÍ∏∞, Ï£ºÎ¨∏ÎÇ¥Ïó≠, Î°úÍ∑∏ÏïÑÏõÉ -->
                    <div class="right-panel">
                        <!-- ÏòàÏÇ∞ Ï†ïÎ≥¥ -->
                        <div class="section">
                            <div class="budget-info">
                                <h3>üí∞ ÏòàÏÇ∞ Ï†ïÎ≥¥</h3>
                                <div id="budgetDetails">
                                    <div class="budget-item">
                                        <span>Ï¥ù ÏòàÏÇ∞:</span>
                                        <span id="totalBudget">-</span>
                                    </div>
                                    <div class="budget-item">
                                        <span>Ïù¥Î≤à Îã¨ ÏÇ¨Ïö©:</span>
                                        <span id="monthlyUsed">-</span>
                                    </div>
                                    <div class="budget-item">
                                        <span>ÎÇ®ÏùÄ ÏòàÏÇ∞:</span>
                                        <span id="remainingBudget">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ïû•Î∞îÍµ¨Îãà -->
                        <div class="section">
                            <div class="cart">
                                <h3>üõí Ïû•Î∞îÍµ¨Îãà</h3>
                                <div id="cartItems">
                                    <p>Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.</p>
                                </div>
                                <div class="cart-total">
                                    Ï¥ù Í∏àÏï°: <span id="cartTotal">0</span>Ïõê
                                </div>
                                <div id="budgetStatus" style="margin-top: 10px; padding: 8px; border-radius: 4px; font-size: 14px; text-align: center;">
                                    <!-- ÏòàÏÇ∞ ÏÉÅÌÉúÍ∞Ä Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                                </div>
                            </div>
                            <button id="orderBtn" class="btn btn-success" disabled>
                                üì¶ Ï£ºÎ¨∏ÌïòÍ∏∞
                            </button>
                        </div>

                        <!-- Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠ -->
                        <div class="section">
                            <div
                                class="accordion-header"
                                onclick="toggleOrderHistory()"
                            >
                                <h2>üìã Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠</h2>
                                <span class="accordion-icon" id="orderHistoryIcon"
                                    >‚ñº</span
                                >
                            </div>
                            <div
                                class="accordion-content"
                                id="orderHistoryContent"
                                style="display: none"
                            >
                                <button id="refreshOrdersBtn" class="btn" style="width: 100%; margin-bottom: 10px;">
                                    üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                                </button>
                                <div id="orderHistory">
                                    <p>Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Î°úÍ∑∏ÏïÑÏõÉ -->
                        <div class="section">
                            <button id="logoutBtn" class="btn btn-danger">
                                üö™ Î°úÍ∑∏ÏïÑÏõÉ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // ===== Ï°∞Î¶¨Ïõê Ï£ºÎ¨∏ ÏãúÏä§ÌÖú - ÌîÑÎ°†Ìä∏ÏóîÎìú =====

            // API URL ÏÑ§Ï†ï (Î≥¥Ïïà Í∞ïÌôî)
            const getApiUrl = () => {
                // ÌîÑÎ°ùÏãú ÏÑ§Ï†ïÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞
                if (window.API_CONFIG && window.API_CONFIG.endpoint) {
                    return window.API_CONFIG.endpoint;
                }
                
                // ÌôòÍ≤Ω Î≥ÄÏàòÏóêÏÑú Í∞ÄÏ†∏Ïò§Í±∞ÎÇò Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©
                const envUrl = window.API_ENDPOINT || process.env.API_ENDPOINT;
                if (envUrl) return envUrl;
                
                // Í∏∞Î≥∏ URL (Ïã§Ï†ú Î∞∞Ìè¨ Ïãú Î≥ÄÍ≤Ω ÌïÑÏöî)
                return "https://script.google.com/macros/s/AKfycbzoFZF8qvHnzi-D_TlRuD0x5cABKGJhIe__z_vRm_jlMsKjB1uVzhEfQlSNly4vC5i9/exec";
            };

            // API Ìò∏Ï∂ú Ìï®Ïàò (Î≥¥Ïïà Í∞ïÌôî)
            const apiCall = async (action, data) => {
                const apiUrl = getApiUrl();
                const url = `${apiUrl}?action=${action}&data=${encodeURIComponent(JSON.stringify(data))}`;
                
                try {
                    const response = await fetch(url);
                    return await response.json();
                } catch (error) {
                    console.error('API Ìò∏Ï∂ú Ïò§Î•ò:', error);
                    throw error;
                }
            };

            // Ï†ÑÏó≠ Î≥ÄÏàò
            let currentUser = null;
            let cart = [];
            let loadingState = {
                isActive: false,
                progress: 0,
                currentStep: 0,
                steps: ["ÏöîÏ≤≠ Ï†ÑÏÜ°", "ÏÑúÎ≤Ñ Ï≤òÎ¶¨", "Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•", "ÏôÑÎ£å"],
            };
            let products = [
                { id: 1, name: "Î∞∞ÎÉáÏ†ÄÍ≥†Î¶¨", price: 2800, unit: "1ea", image: "resorce/Î∞∞ÎÉáÏ†ÄÍ≥†Î¶¨.png" },
                { id: 2, name: "ÏÜçÏã∏Í∞ú", price: 4000, unit: "1ea", image: "resorce/ÏÜçÏã∏Í∞ú.png" },
                { id: 3, name: "Ïó†Î≥¥ ÏÜêÏàòÍ±¥", price: 36300, unit: "100ea", image: "resorce/Ïó†Î≥¥ ÏÜêÏàòÍ±¥.png" },
                { id: 4, name: "Ïó†Î≥¥ ÎÇòÏóº ÏÜêÏàòÍ±¥", price: 3900, unit: "10ea", image: "resorce/Ïó†Î≥¥ ÎÇòÏóº ÏÜêÏàòÍ±¥.jpg" },
                {
                    id: 5,
                    name: "Ïä§ÎßàÌä∏ 8Ï¢Ö ÏÑ∏Ìä∏ (Ï†ÄÍ≥†Î¶¨/ÌÑ±Î∞õÏù¥/ÏÜêÏàòÍ±¥/ÏÜêÏã∏Í∞ú/Î∞úÏã∏Í∞ú/Í≤âÏã∏Í∞ú/Î™®Ïûê/ÎØ∏ÎãàÎ∞©ÏàòÌå®Îìú)",
                    price: 27500,
                    unit: "1ea",
                    image: "resorce/Ïä§ÎßàÌä∏ 8Ï¢Ö ÏÑ∏Ìä∏.png",
                },
                { id: 6, name: "Ïä§ÏôÄÎì§", price: 13800, unit: "1ea", image: "resorce/Ïä§ÏôÄÎì§.jpg" },
                { id: 7, name: "Î∏îÎû≠ÌÇ∑", price: 12100, unit: "1ea", image: "resorce/Î∏îÎû≠ÌÇ∑.jpg" },
                {
                    id: 8,
                    name: "ÌïòÍ∏∞Ïä§ ÎÑ§Ïù¥Ï≤òÎ©îÏù¥Îìú 1Îã®Í≥Ñ Í≥µÏö©",
                    price: 48000,
                    unit: "1box (198ea)",
                    image: "resorce/ÎÑ§Ïù¥Ï≤òÎ©îÏù¥Îìú 1Îã®Í≥Ñ Í≥µÏö©.png",
                },
                { id: 9, name: "ÎÑ§ÏûÑÏπ¥Îìú ÌïëÌÅ¨", price: 5000, unit: "100ea", image: "resorce/ÎÑ§ÏûÑÏπ¥ÎìúÌïëÌÅ¨.png" },
                { id: 10, name: "ÎÑ§ÏûÑÏπ¥Îìú Î∏îÎ£®", price: 5000, unit: "100ea", image: "resorce/ÎÑ§ÏûÑÏπ¥ÎìúÎ∏îÎ£®.png" },
                { id: 11, name: "ÏÇ∞Î™®Ïö© ÌåîÏ∞å", price: 6100, unit: "20ea", image: "resorce/Ïã†ÏÉùÏïÑ ÌåîÏ∞å.png" },
                {
                    id: 12,
                    name: "Ïã†ÏÉùÏïÑÏö© ÌåîÏ∞å ÌïëÌÅ¨",
                    price: 6100,
                    unit: "20ea",
                    image: "resorce/Ïã†ÏÉùÏïÑ ÌåîÏ∞å.png",
                },
                {
                    id: 13,
                    name: "Ïã†ÏÉùÏïÑÏö© ÌåîÏ∞å Î∏îÎ£®",
                    price: 6100,
                    unit: "20ea",
                    image: "resorce/Ïã†ÏÉùÏïÑ ÌåîÏ∞å.png",
                },
                {
                    id: 14,
                    name: "Ï†ïÏãùÌíà Î≤†ÏßÄÎ∞Ä Îã¨ÏΩ§Ìïú ÎπÑ ÎëêÏú†",
                    price: 44800,
                    unit: "1box (64ea)",
                    image: "resorce/Î≤†ÏßÄÎ∞ÄÎã¨ÏΩ§ÌïúÎπÑÎëêÏú†.png",
                },
            ];

            // DOM ÏöîÏÜåÎì§
            const loginSection = document.getElementById("loginSection");
            const mainSection = document.getElementById("mainSection");
            const loginBtn = document.getElementById("loginBtn");
            const logoutBtn = document.getElementById("logoutBtn");
            const orderBtn = document.getElementById("orderBtn");
            const refreshOrdersBtn =
                document.getElementById("refreshOrdersBtn");

            // Ï¥àÍ∏∞Ìôî
            document.addEventListener("DOMContentLoaded", function () {
                setupEventListeners();
                renderProducts();
                // Ï¥àÍ∏∞ Î°úÍ∑∏Ïù∏ Î™®Îìú ÏÑ§Ï†ï
                document.querySelector('.container').classList.add('login-mode');
            });

            // ===== Î°úÎî© ÏÉÅÌÉú Í¥ÄÎ¶¨ Ìï®ÏàòÎì§ =====

            // Î°úÎî© ÏãúÏûë
            function startLoading(message = "Ï≤òÎ¶¨ Ï§ë...", showSteps = false) {
                loadingState.isActive = true;
                loadingState.progress = 0;
                loadingState.currentStep = 0;

                const overlay = document.getElementById("loadingOverlay");
                const loadingText = document.getElementById("loadingText");
                const progressSteps = document.getElementById("progressSteps");
                const progressBar =
                    document.getElementById("loadingProgressBar");

                loadingText.textContent = message;
                progressBar.style.width = "0%";

                if (showSteps) {
                    progressSteps.style.display = "flex";
                    resetProgressSteps();
                } else {
                    progressSteps.style.display = "none";
                }

                overlay.style.display = "flex";
            }

            // Î°úÎî© Ï¢ÖÎ£å
            function stopLoading() {
                loadingState.isActive = false;
                const overlay = document.getElementById("loadingOverlay");
                overlay.style.display = "none";
            }

            // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
            function updateProgress(progress, message = null) {
                if (!loadingState.isActive) return;

                loadingState.progress = progress;
                const progressBar =
                    document.getElementById("loadingProgressBar");
                progressBar.style.width = progress + "%";

                if (message) {
                    const loadingText = document.getElementById("loadingText");
                    loadingText.textContent = message;
                }
            }

            // Îã§Ïùå Îã®Í≥ÑÎ°ú ÏßÑÌñâ
            function nextStep() {
                if (!loadingState.isActive) return;

                loadingState.currentStep++;
                updateProgressSteps();

                if (loadingState.currentStep >= loadingState.steps.length) {
                    setTimeout(() => {
                        stopLoading();
                    }, 500);
                }
            }

            // ÏßÑÌñâ Îã®Í≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
            function updateProgressSteps() {
                const steps = ["step1", "step2", "step3", "step4"];
                const progressFill = document.getElementById("progressFill");

                steps.forEach((stepId, index) => {
                    const stepCircle = document.getElementById(stepId);
                    if (index < loadingState.currentStep) {
                        stepCircle.className = "step-circle completed";
                    } else if (index === loadingState.currentStep) {
                        stepCircle.className = "step-circle active";
                    } else {
                        stepCircle.className = "step-circle";
                    }
                });

                const progressPercent =
                    (loadingState.currentStep / (steps.length - 1)) * 100;
                progressFill.style.width = progressPercent + "%";
            }

            // ÏßÑÌñâ Îã®Í≥Ñ Ï¥àÍ∏∞Ìôî
            function resetProgressSteps() {
                const steps = ["step1", "step2", "step3", "step4"];
                steps.forEach((stepId) => {
                    const stepCircle = document.getElementById(stepId);
                    stepCircle.className = "step-circle";
                });
                document.getElementById("progressFill").style.width = "0%";
            }

            // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉú ÏÑ§Ï†ï
            function setButtonLoading(
                button,
                isLoading,
                loadingText = "Ï≤òÎ¶¨ Ï§ë..."
            ) {
                if (isLoading) {
                    button.disabled = true;
                    button.classList.add("btn-loading");
                    button.dataset.originalText = button.textContent;
                    button.textContent = loadingText;
                } else {
                    button.disabled = false;
                    button.classList.remove("btn-loading");
                    if (button.dataset.originalText) {
                        button.textContent = button.dataset.originalText;
                    }
                }
            }

            // ÏãúÎÆ¨Î†àÏù¥ÏÖòÎêú ÏßÄÏó∞ ÏãúÍ∞Ñ (Ïã§Ï†ú API Ìò∏Ï∂ú ÏãúÍ∞ÑÏùÑ Î™®Î∞©)
            function simulateApiDelay(minMs = 800, maxMs = 2000) {
                return new Promise((resolve) => {
                    const delay = Math.random() * (maxMs - minMs) + minMs;
                    setTimeout(resolve, delay);
                });
            }

            // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
            function setupEventListeners() {
                loginBtn.addEventListener("click", handleLogin);
                logoutBtn.addEventListener("click", handleLogout);
                orderBtn.addEventListener("click", handleOrder);
                refreshOrdersBtn.addEventListener("click", loadOrderHistory);
                
                // ESC ÌÇ§Î°ú ÏïåÎ¶º Îã´Í∏∞
                document.addEventListener("keydown", function(event) {
                    if (event.key === "Escape") {
                        closeNotification();
                    }
                });
                
                // ÏïåÎ¶º Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
                document.getElementById("notificationModal").addEventListener("click", function(event) {
                    if (event.target === this) {
                        closeNotification();
                    }
                });
            }

            // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
            async function handleLogin() {
                const userId = document.getElementById("userId").value.trim();
                const pin = document.getElementById("pin").value.trim();

                if (!userId || !pin) {
                    showMessage(
                        "Ï°∞Î¶¨Ïõê IDÏôÄ PIN Î≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.",
                        "error",
                        "loginMessage"
                    );
                    return;
                }

                // Î°úÎî© ÏÉÅÌÉú ÏãúÏûë
                startLoading("Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨ Ï§ë...", true);
                setButtonLoading(loginBtn, true, "Î°úÍ∑∏Ïù∏ Ï§ë...");

                try {
                    // Îã®Í≥Ñ 1: ÏöîÏ≤≠ Ï†ÑÏÜ°
                    updateProgress(10, "Î°úÍ∑∏Ïù∏ Ï†ïÎ≥¥ Ï†ÑÏÜ° Ï§ë...");
                    await simulateApiDelay(300, 600);
                    nextStep();

                    const requestData = {
                        userId: userId,
                        pin: pin,
                    };

                    // Îã®Í≥Ñ 2: ÏÑúÎ≤Ñ Ï≤òÎ¶¨
                    updateProgress(30, "ÏÑúÎ≤ÑÏóêÏÑú Ïù∏Ï¶ù Ï≤òÎ¶¨ Ï§ë...");
                    nextStep();
                    await simulateApiDelay(500, 1000);

                    const result = await apiCall('login', requestData);

                    // Îã®Í≥Ñ 3: Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
                    updateProgress(70, "ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ Î°úÎìú Ï§ë...");
                    nextStep();
                    await simulateApiDelay(300, 600);

                    if (result.status === "success") {
                        currentUser = result.user;
                        showMainSection();
                        updateBudgetInfo(result.budget);

                        // Îã®Í≥Ñ 4: ÏôÑÎ£å
                        updateProgress(100, "Î°úÍ∑∏Ïù∏ ÏôÑÎ£å!");
                        nextStep();
                        await simulateApiDelay(200, 400);

                        loadOrderHistory();
                        showMessage("Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ!", "success", "loginMessage");
                    } else {
                        showMessage(result.message, "error", "loginMessage");
                        
                        // Î≥¥Ïïà ÏÉÅÌÉú ÌëúÏãú (Î°úÍ∑∏Ïù∏ Ïã§Ìå® Ïãú)
                        if (result.message.includes("ÎÇ®ÏùÄ ÏãúÎèÑ ÌöüÏàò")) {
                            showSecurityStatus(result.message, "warning");
                        } else if (result.message.includes("Í≥ÑÏ†ïÏù¥ Ïû†Í≤ºÏäµÎãàÎã§")) {
                            showSecurityStatus(result.message, "error");
                        }
                    }
                } catch (error) {
                    console.error("Î°úÍ∑∏Ïù∏ Ïò§Î•ò:", error);
                    showMessage(
                        "Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: " + error.message,
                        "error",
                        "loginMessage"
                    );
                } finally {
                    stopLoading();
                    setButtonLoading(loginBtn, false);
                }
            }

            // Î°úÍ∑∏ÏïÑÏõÉ Ï≤òÎ¶¨
            function handleLogout() {
                currentUser = null;
                cart = [];
                showLoginSection();
                clearCart();
                showMessage("Î°úÍ∑∏ÏïÑÏõÉÎêòÏóàÏäµÎãàÎã§.", "info", "loginMessage");
            }

            // Î©îÏù∏ ÏÑπÏÖò ÌëúÏãú
            function showMainSection() {
                loginSection.classList.add("hidden");
                mainSection.classList.remove("hidden");
                document.querySelector('.container').classList.remove('login-mode');
            }

            // Î°úÍ∑∏Ïù∏ ÏÑπÏÖò ÌëúÏãú
            function showLoginSection() {
                mainSection.classList.add("hidden");
                loginSection.classList.remove("hidden");
                document.querySelector('.container').classList.add('login-mode');
                document.getElementById("userId").value = "";
                document.getElementById("pin").value = "";
                
                // Î≥¥Ïïà ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
                hideSecurityStatus();
            }
            
            // Î≥¥Ïïà ÏÉÅÌÉú ÌëúÏãú
            function showSecurityStatus(message, type = "info") {
                const securityStatus = document.getElementById("securityStatus");
                if (securityStatus) {
                    securityStatus.textContent = message;
                    securityStatus.style.display = "block";
                    
                    // ÌÉÄÏûÖÏóê Îî∞Î•∏ Ïä§ÌÉÄÏùº Ï†ÅÏö©
                    securityStatus.style.backgroundColor = type === "warning" ? "#fff3cd" : 
                                                       type === "error" ? "#f8d7da" : "#d1ecf1";
                    securityStatus.style.color = type === "warning" ? "#856404" : 
                                              type === "error" ? "#721c24" : "#0c5460";
                    securityStatus.style.border = `1px solid ${type === "warning" ? "#ffeaa7" : 
                                                           type === "error" ? "#f5c6cb" : "#bee5eb"}`;
                }
            }
            
            // Î≥¥Ïïà ÏÉÅÌÉú Ïà®Í∏∞Í∏∞
            function hideSecurityStatus() {
                const securityStatus = document.getElementById("securityStatus");
                if (securityStatus) {
                    securityStatus.style.display = "none";
                }
            }

            // ÏòàÏÇ∞ Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            function updateBudgetInfo(budget) {
                document.getElementById("totalBudget").textContent =
                    budget.totalBudget.toLocaleString() + "Ïõê";
                document.getElementById("monthlyUsed").textContent =
                    budget.monthlyTotal.toLocaleString() + "Ïõê";
                document.getElementById("remainingBudget").textContent =
                    budget.remainingBudget.toLocaleString() + "Ïõê";
            }

            // ÏÉÅÌíà Î†åÎçîÎßÅ
            function renderProducts() {
                const productGrid = document.getElementById("productGrid");
                productGrid.innerHTML = "";

                products.forEach((product) => {
                    const productCard = document.createElement("div");
                    productCard.className = "product-card";
                    
                    // Ïù¥ÎØ∏ÏßÄ HTML ÏÉùÏÑ±
                    const imageHtml = product.image 
                        ? `<img src="${product.image}" alt="${product.name}" onerror="this.parentElement.innerHTML='<div class=\\'product-image-placeholder\\'><span>üì∑</span><span>Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå</span></div>'">`
                        : `<div class="product-image-placeholder">
                            <span>üì∑</span>
                            <span>Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå</span>
                           </div>`;

                    productCard.innerHTML = `
                        <div class="product-image">
                            ${imageHtml}
                        </div>
                        <h4>${product.name}</h4>
                        <div class="price">${product.price.toLocaleString()}Ïõê</div>
                        <div class="unit">${product.unit}</div>
                        <div class="quantity-control">
                            <button onclick="decreaseQuantity(${product.id})">-</button>
                            <input type="number" id="qty_${product.id}" value="0" min="0" max="99" onchange="updateQuantity(${product.id})">
                            <button onclick="increaseQuantity(${product.id})">+</button>
                        </div>
                    `;
                    productGrid.appendChild(productCard);
                });
            }

            // ÏàòÎüâ Ï¶ùÍ∞Ä
            function increaseQuantity(productId) {
                const input = document.getElementById(`qty_${productId}`);
                const currentValue = parseInt(input.value) || 0;
                const product = products.find((p) => p.id === productId);
                
                // ÌòÑÏû¨ ÎÇ®ÏùÄ ÏòàÏÇ∞ ÌôïÏù∏
                const remainingBudgetElement = document.getElementById("remainingBudget");
                const remainingBudgetText = remainingBudgetElement ? remainingBudgetElement.textContent : "0Ïõê";
                const remainingBudget = parseInt(remainingBudgetText.replace(/[^0-9]/g, "")) || 0;
                
                // ÌòÑÏû¨ Ïû•Î∞îÍµ¨Îãà Ï¥ùÏï° Í≥ÑÏÇ∞ (ÌòÑÏû¨ ÏÉÅÌíà Ï†úÏô∏)
                let currentCartTotal = 0;
                cart.forEach((item) => {
                    if (item.id !== productId) {
                        currentCartTotal += item.total;
                    }
                });
                
                // Ï∂îÍ∞ÄÌï† ÏÉÅÌíàÏùò Í∞ÄÍ≤©
                const additionalCost = product.price;
                
                // ÏòàÏÇ∞ Ï¥àÍ≥º Ïó¨Î∂Ä ÌôïÏù∏
                if (currentCartTotal + additionalCost > remainingBudget) {
                    showMessage(`ÏòàÏÇ∞ÏùÑ Ï¥àÍ≥ºÌïòÏó¨ Ï∂îÍ∞ÄÌï† Ïàò ÏóÜÏäµÎãàÎã§. (Ï¥àÍ≥º: ${(currentCartTotal + additionalCost - remainingBudget).toLocaleString()}Ïõê)`, "error");
                    return;
                }
                
                input.value = currentValue + 1;
                updateQuantity(productId);
            }

            // ÏàòÎüâ Í∞êÏÜå
            function decreaseQuantity(productId) {
                const input = document.getElementById(`qty_${productId}`);
                const currentValue = parseInt(input.value);
                if (currentValue > 0) {
                    input.value = currentValue - 1;
                    updateQuantity(productId);
                }
            }

            // ÏàòÎüâ ÏóÖÎç∞Ïù¥Ìä∏
            function updateQuantity(productId) {
                const input = document.getElementById(`qty_${productId}`);
                let quantity = parseInt(input.value) || 0;
                const product = products.find((p) => p.id === productId);

                // ÌòÑÏû¨ ÎÇ®ÏùÄ ÏòàÏÇ∞ ÌôïÏù∏
                const remainingBudgetElement = document.getElementById("remainingBudget");
                const remainingBudgetText = remainingBudgetElement ? remainingBudgetElement.textContent : "0Ïõê";
                const remainingBudget = parseInt(remainingBudgetText.replace(/[^0-9]/g, "")) || 0;
                
                // ÌòÑÏû¨ Ïû•Î∞îÍµ¨Îãà Ï¥ùÏï° Í≥ÑÏÇ∞ (ÌòÑÏû¨ ÏÉÅÌíà Ï†úÏô∏)
                let currentCartTotal = 0;
                cart.forEach((item) => {
                    if (item.id !== productId) {
                        currentCartTotal += item.total;
                    }
                });
                
                // ÏöîÏ≤≠Îêú ÏàòÎüâÏùò Ï¥ù Í∞ÄÍ≤©
                const requestedTotal = product.price * quantity;
                
                // ÏòàÏÇ∞ Ï¥àÍ≥º Ïó¨Î∂Ä ÌôïÏù∏
                if (currentCartTotal + requestedTotal > remainingBudget) {
                    // ÏòàÏÇ∞ ÎÇ¥ÏóêÏÑú Í∞ÄÎä•Ìïú ÏµúÎåÄ ÏàòÎüâ Í≥ÑÏÇ∞
                    const maxAffordableQuantity = Math.floor((remainingBudget - currentCartTotal) / product.price);
                    
                    if (maxAffordableQuantity <= 0) {
                        showMessage(`ÏòàÏÇ∞ Î∂ÄÏ°±ÏúºÎ°ú Ï∂îÍ∞ÄÌï† Ïàò ÏóÜÏäµÎãàÎã§.`, "error");
                        input.value = "0";
                        quantity = 0;
                    } else {
                        showMessage(`ÏòàÏÇ∞ Ï¥àÍ≥ºÎ°ú ÏàòÎüâÏù¥ ${maxAffordableQuantity}Í∞úÎ°ú Ï°∞Ï†ïÎêòÏóàÏäµÎãàÎã§.`, "info");
                        input.value = maxAffordableQuantity;
                        quantity = maxAffordableQuantity;
                    }
                }

                // Ïû•Î∞îÍµ¨ÎãàÏóêÏÑú Í∏∞Ï°¥ Ìï≠Î™© Ï†úÍ±∞
                cart = cart.filter((item) => item.id !== productId);

                // ÏàòÎüâÏù¥ ÏûàÏúºÎ©¥ Ïû•Î∞îÍµ¨ÎãàÏóê Ï∂îÍ∞Ä
                if (quantity > 0) {
                    cart.push({
                        id: productId,
                        name: product.name,
                        price: product.price,
                        quantity: quantity,
                        total: product.price * quantity,
                    });
                }

                updateCart();
            }

            // Ïû•Î∞îÍµ¨Îãà ÏóÖÎç∞Ïù¥Ìä∏
            function updateCart() {
                const cartItems = document.getElementById("cartItems");
                const cartTotal = document.getElementById("cartTotal");

                if (cart.length === 0) {
                    cartItems.innerHTML = "<p>Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.</p>";
                    cartTotal.textContent = "0";
                    orderBtn.disabled = true;
                    
                    // Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏùÑ ÎïåÎèÑ ÏòàÏÇ∞ ÏÉÅÌÉú ÌëúÏãú
                    const remainingBudgetElement = document.getElementById("remainingBudget");
                    const remainingBudgetText = remainingBudgetElement ? remainingBudgetElement.textContent : "0Ïõê";
                    const remainingBudget = parseInt(remainingBudgetText.replace(/[^0-9]/g, "")) || 0;
                    
                    const budgetStatusDiv = document.getElementById("budgetStatus");
                    budgetStatusDiv.innerHTML = `
                        <div style="background: #f8f8f8; color: #000000; border: 1px solid #e5e5e5; padding: 10px; border-radius: 4px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">üí∞ ÏòàÏÇ∞ ÌòÑÌô©</div>
                            <div>ÏÇ¨Ïö© Í∞ÄÎä• ÏòàÏÇ∞: ${remainingBudget.toLocaleString()}Ïõê</div>
                        </div>
                    `;
                    return;
                }

                let total = 0;
                cartItems.innerHTML = "";

                cart.forEach((item) => {
                    const itemDiv = document.createElement("div");
                    itemDiv.className = "cart-item";
                    itemDiv.innerHTML = `
                    <span>${item.name} x ${item.quantity}</span>
                    <span>${item.total.toLocaleString()}Ïõê</span>
                `;
                    cartItems.appendChild(itemDiv);
                    total += item.total;
                });

                // ÌòÑÏû¨ ÎÇ®ÏùÄ ÏòàÏÇ∞ ÌôïÏù∏
                const remainingBudgetElement = document.getElementById("remainingBudget");
                const remainingBudgetText = remainingBudgetElement ? remainingBudgetElement.textContent : "0Ïõê";
                const remainingBudget = parseInt(remainingBudgetText.replace(/[^0-9]/g, "")) || 0;

                // ÏòàÏÇ∞ Ï¥àÍ≥º Ïó¨Î∂Ä ÌôïÏù∏
                const isOverBudget = total > remainingBudget;
                const budgetStatusDiv = document.getElementById("budgetStatus");
                
                if (isOverBudget) {
                    budgetStatusDiv.innerHTML = `
                        <div style="background: #f8f8f8; color: #000000; border: 1px solid #e5e5e5; padding: 10px; border-radius: 4px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">‚ö†Ô∏è ÏòàÏÇ∞ Ï¥àÍ≥º</div>
                            <div>Ï¥àÍ≥º Í∏àÏï°: ${(total - remainingBudget).toLocaleString()}Ïõê</div>
                            <div>ÎÇ®ÏùÄ ÏòàÏÇ∞: ${remainingBudget.toLocaleString()}Ïõê</div>
                        </div>
                    `;
                } else {
                    budgetStatusDiv.innerHTML = `
                        <div style="background: #f8f8f8; color: #000000; border: 1px solid #e5e5e5; padding: 10px; border-radius: 4px;">
                            <div style="font-weight: bold; margin-bottom: 5px;">‚úÖ ÏòàÏÇ∞ ÎÇ¥</div>
                            <div>ÎÇ®ÏùÄ ÏòàÏÇ∞: ${(remainingBudget - total).toLocaleString()}Ïõê</div>
                            <div>ÏÇ¨Ïö© ÏòàÏ†ï: ${total.toLocaleString()}Ïõê</div>
                        </div>
                    `;
                }

                cartTotal.textContent = total.toLocaleString();

                // ÏòàÏÇ∞ Ï¥àÍ≥º Ïãú Ï£ºÎ¨∏ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî
                orderBtn.disabled = isOverBudget;
                if (isOverBudget) {
                    orderBtn.title = "ÏòàÏÇ∞ÏùÑ Ï¥àÍ≥ºÌïòÏó¨ Ï£ºÎ¨∏Ìï† Ïàò ÏóÜÏäµÎãàÎã§.";
                } else {
                    orderBtn.title = "Ï£ºÎ¨∏ÌïòÍ∏∞";
                }
            }

            // Ïû•Î∞îÍµ¨Îãà Ï¥àÍ∏∞Ìôî
            function clearCart() {
                cart = [];
                products.forEach((product) => {
                    const input = document.getElementById(`qty_${product.id}`);
                    if (input) input.value = "0";
                });
                updateCart();
            }

            // Ï£ºÎ¨∏ Ï≤òÎ¶¨
            async function handleOrder() {
                if (cart.length === 0) {
                    showMessage("Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§.", "error");
                    return;
                }

                // Î≤ÑÌäº Î°úÎî© ÏÉÅÌÉúÎßå ÏÑ§Ï†ï (Î°úÎî© Ïò§Î≤ÑÎ†àÏù¥ ÏóÜÏù¥)
                setButtonLoading(orderBtn, true, "Ï£ºÎ¨∏ Ï≤òÎ¶¨ Ï§ë...");

                try {
                    const orderData = {
                        userId: currentUser.userId,
                        pin: currentUser.pin,
                        items: cart.map((item) => ({
                            name: item.name,
                            quantity: item.quantity,
                            price: item.price,
                        })),
                    };

                    const result = await apiCall('order', orderData);

                    if (result.status === "success") {
                        showMessage(
                            `Ï£ºÎ¨∏Ïù¥ ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§! ÎÇ®ÏùÄ ÏòàÏÇ∞: ${result.remainingBudget.toLocaleString()}Ïõê`,
                            "success"
                        );
                        updateBudgetInfo(result.budgetInfo);
                        clearCart();
                        loadOrderHistory();
                    } else {
                        showMessage(result.message, "error");
                    }
                } catch (error) {
                    showMessage("Ï£ºÎ¨∏ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.", "error");
                } finally {
                    setButtonLoading(orderBtn, false);
                }
            }

            // Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Î°úÎìú
            async function loadOrderHistory() {
                if (!currentUser) return;

                // Í∞ÑÎã®Ìïú Î°úÎî© ÌëúÏãú (Îã®Í≥ÑÎ≥Ñ ÏßÑÌñâ ÏóÜÏù¥)
                startLoading("Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Î∂àÎü¨Ïò§Îäî Ï§ë...", false);
                setButtonLoading(refreshOrdersBtn, true, "ÏÉàÎ°úÍ≥†Ïπ® Ï§ë...");

                const orderHistory = document.getElementById("orderHistory");
                orderHistory.innerHTML =
                    "<p>Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>";

                try {
                    // ÏßÑÌñâÎ•† ÏóÖÎç∞Ïù¥Ìä∏
                    updateProgress(30, "ÏÑúÎ≤ÑÏóêÏÑú Îç∞Ïù¥ÌÑ∞ ÏöîÏ≤≠ Ï§ë...");
                    await simulateApiDelay(400, 800);

                    const result = await apiCall('getOrders', {
                        userId: currentUser.userId,
                    });

                    updateProgress(70, "Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Ï≤òÎ¶¨ Ï§ë...");
                    await simulateApiDelay(300, 600);

                    updateProgress(100, "ÏôÑÎ£å!");
                    await simulateApiDelay(200, 400);

                    if (result.status === "success") {
                        renderOrderHistory(result.orders);
                    } else {
                        orderHistory.innerHTML =
                            "<p>Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>";
                    }
                } catch (error) {
                    orderHistory.innerHTML =
                        "<p>Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠ÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.</p>";
                } finally {
                    stopLoading();
                    setButtonLoading(refreshOrdersBtn, false);
                }
            }

            // Ï£ºÎ¨∏ ÎÇ¥Ïó≠ Î†åÎçîÎßÅ
            function renderOrderHistory(orders) {
                const orderHistory = document.getElementById("orderHistory");

                if (orders.length === 0) {
                    orderHistory.innerHTML =
                        "<p>Ïù¥Î≤àÎã¨ Ï£ºÎ¨∏ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</p>";
                    return;
                }

                // Ï£ºÎ¨∏ IDÎ≥ÑÎ°ú Í∑∏Î£πÌôî
                const orderGroups = {};
                orders.forEach((order) => {
                    if (!orderGroups[order.orderId]) {
                        orderGroups[order.orderId] = [];
                    }
                    orderGroups[order.orderId].push(order);
                });

                let html = "";
                Object.keys(orderGroups).forEach((orderId) => {
                    const group = orderGroups[orderId];
                    const firstOrder = group[0];
                    const totalAmount = group.reduce(
                        (sum, item) => sum + item.total,
                        0
                    );

                    html += `
                     <div style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 4px;">
                         <h4>Ï£ºÎ¨∏ ID: ${orderId}</h4>
                         <p>Ï£ºÎ¨∏Ïùº: ${new Date(
                             firstOrder.timestamp
                         ).toLocaleString("ko-KR", {
                             timeZone: "Asia/Seoul",
                         })}</p>
                         <div style="background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 4px;">
                             <p><strong>üì¶ Î∞∞ÏÜ° Ï†ïÎ≥¥</strong></p>
                             <p>Î∞∞ÏÜ°ÏßÄ: ${
                                 firstOrder.deliveryAddress || "ÎØ∏ÏûÖÎ†•"
                             }</p>
                             <p>ÏàòÏ∑®Ïù∏: ${firstOrder.recipient || "ÎØ∏ÏûÖÎ†•"}</p>
                             <p>Ïó∞ÎùΩÏ≤ò: ${firstOrder.phone || "ÎØ∏ÏûÖÎ†•"}</p>
                         </div>
                         <ul>
                             ${group
                                 .map(
                                     (item) => `
                                 <li>${item.itemName} x ${
                                         item.quantity
                                     } = ${item.total.toLocaleString()}Ïõê</li>
                             `
                                 )
                                 .join("")}
                         </ul>
                         <p><strong>Ï¥ù Í∏àÏï°: ${totalAmount.toLocaleString()}Ïõê</strong></p>
                     </div>
                 `;
                });

                orderHistory.innerHTML = html;
            }

            // Ï§ëÏïô ÏïåÎ¶º ÌëúÏãú
            function showNotification(title, message, type = "info", autoClose = true) {
                const modal = document.getElementById("notificationModal");
                const icon = document.getElementById("notificationIcon");
                const titleElement = document.getElementById("notificationTitle");
                const messageElement = document.getElementById("notificationMessage");

                // ÌÉÄÏûÖÏóê Îî∞Î•∏ ÏïÑÏù¥ÏΩò ÏÑ§Ï†ï
                const icons = {
                    success: "‚úÖ",
                    error: "‚ùå",
                    warning: "‚ö†Ô∏è",
                    info: "‚ÑπÔ∏è"
                };

                icon.textContent = icons[type] || icons.info;
                titleElement.textContent = title;
                messageElement.textContent = message;

                // ÌÉÄÏûÖÏóê Îî∞Î•∏ Ïä§ÌÉÄÏùº Ï†ÅÏö©
                const content = modal.querySelector(".notification-content");
                content.style.borderLeft = `4px solid ${
                    type === "success" ? "#000000" :
                    type === "error" ? "#000000" :
                    type === "warning" ? "#000000" :
                    "#000000"
                }`;

                modal.style.display = "block";

                // ÏûêÎèô Îã´Í∏∞ ÏÑ§Ï†ï
                if (autoClose) {
                    setTimeout(() => {
                        closeNotification();
                    }, 10000);
                }
            }

            // ÏïåÎ¶º Îã´Í∏∞
            function closeNotification() {
                const modal = document.getElementById("notificationModal");
                modal.style.display = "none";
            }

            // Î©îÏãúÏßÄ ÌëúÏãú (Í∏∞Ï°¥ Ìï®Ïàò Ïú†ÏßÄ, Ìò∏ÌôòÏÑ± ÏúÑÌï¥)
            function showMessage(text, type, elementId = null) {
                if (!elementId) {
                    // Ï§ëÏïô ÏïåÎ¶ºÏúºÎ°ú ÌëúÏãú
                    const titles = {
                        success: "ÏÑ±Í≥µ",
                        error: "Ïò§Î•ò",
                        warning: "Í≤ΩÍ≥†",
                        info: "ÏïåÎ¶º"
                    };
                    showNotification(titles[type] || "ÏïåÎ¶º", text, type);
                } else {
                    // Í∏∞Ï°¥ Î∞©ÏãùÏúºÎ°ú ÌëúÏãú (Î°úÍ∑∏Ïù∏ Î©îÏãúÏßÄ Îì±)
                    const messageDiv = document.getElementById(elementId);
                    messageDiv.className = `message ${type}`;
                    messageDiv.textContent = text;
                }
            }

            // Ï£ºÎ¨∏ ÎÇ¥Ïó≠ ÏïÑÏΩîÎîîÏñ∏ ÌÜ†Í∏Ä
            function toggleOrderHistory() {
                const content = document.getElementById("orderHistoryContent");
                const icon = document.getElementById("orderHistoryIcon");

                if (content.style.display === "none") {
                    content.style.display = "block";
                    icon.textContent = "‚ñ≤";
                    icon.style.transform = "rotate(180deg)";
                } else {
                    content.style.display = "none";
                    icon.textContent = "‚ñº";
                    icon.style.transform = "rotate(0deg)";
                }
            }

            // ===== Ïù¥ÎØ∏ÏßÄ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§ =====

            // ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ï
            function setProductImage(productId, imageUrl) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    product.image = imageUrl;
                    renderProducts(); // ÏÉÅÌíà Î™©Î°ù Îã§Ïãú Î†åÎçîÎßÅ
                }
            }

            // ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞
            function removeProductImage(productId) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    product.image = null;
                    renderProducts(); // ÏÉÅÌíà Î™©Î°ù Îã§Ïãú Î†åÎçîÎßÅ
                }
            }

            // Î™®Îì† ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ ÏùºÍ¥Ñ ÏÑ§Ï†ï (ÏòàÏãú)
            function setAllProductImages(imageUrls) {
                // imageUrlsÎäî {productId: imageUrl} ÌòïÌÉúÏùò Í∞ùÏ≤¥
                Object.keys(imageUrls).forEach(productId => {
                    setProductImage(parseInt(productId), imageUrls[productId]);
                });
            }

            // Ïù¥ÎØ∏ÏßÄ URL Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            function isValidImageUrl(url) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve(true);
                    img.onerror = () => resolve(false);
                    img.src = url;
                });
            }

            // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ (Í¥ÄÎ¶¨ÏûêÏö©)
            function previewProductImage(productId, imageUrl) {
                const product = products.find(p => p.id === productId);
                if (product) {
                    // ÏûÑÏãúÎ°ú Ïù¥ÎØ∏ÏßÄ ÏÑ§Ï†ïÌïòÏó¨ ÎØ∏Î¶¨Î≥¥Í∏∞
                    const originalImage = product.image;
                    product.image = imageUrl;
                    renderProducts();
                    
                    // 3Ï¥à ÌõÑ ÏõêÎûò ÏÉÅÌÉúÎ°ú Î≥µÏõê
                    setTimeout(() => {
                        product.image = originalImage;
                        renderProducts();
                    }, 3000);
                }
            }

            // ===== Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä ÏòàÏãú =====
            /*
            // Í∞úÎ≥Ñ ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä
            setProductImage(1, "images/baby-clothes.jpg");
            setProductImage(2, "images/swaddle.jpg");
            setProductImage(3, "images/handkerchief.jpg");

            // ÏùºÍ¥Ñ Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä
            const imageUrls = {
                1: "images/baby-clothes.jpg",
                2: "images/swaddle.jpg",
                3: "images/handkerchief.jpg",
                4: "images/printed-handkerchief.jpg",
                5: "images/smart-set.jpg",
                6: "images/swaddle-blanket.jpg",
                7: "images/blanket.jpg",
                8: "images/huggies-diaper.jpg",
                9: "images/namecard-pink.jpg",
                10: "images/namecard-blue.jpg",
                11: "images/mother-bracelet.jpg",
                12: "images/baby-bracelet-pink.jpg",
                13: "images/baby-bracelet-blue.jpg",
                14: "images/vegemil-soy-milk.jpg"
            };
            setAllProductImages(imageUrls);

            // Ïù¥ÎØ∏ÏßÄ URL Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨ ÌõÑ Ï∂îÍ∞Ä
            isValidImageUrl("images/baby-clothes.jpg").then(isValid => {
                if (isValid) {
                    setProductImage(1, "images/baby-clothes.jpg");
                }
            });
            */
        </script>
    </body>
</html>
