# 조리원 주문 시스템

## 📋 시스템 개요

조리원들이 월별 예산 내에서 식품을 주문할 수 있는 시스템입니다.

### 🎯 주요 기능

-   **사용자 인증**: 조리원ID + PIN 조합으로 로그인
-   **예산 관리**: 월별 예산 설정 및 실시간 잔액 확인
-   **상품 주문**: 장바구니 기능과 PIN 재확인
-   **주문 내역**: 개인별 주문 히스토리 조회
-   **자동 초기화**: 매월 1일 자동으로 마스터 금액 초기화

## 🏗️ 시스템 구조

```
Frontend (HTML/JS) ←→ Google Apps Script API ←→ Google Sheets (데이터베이스)
```

### 📊 데이터 구조

**1번 시트 (Users - 사용자 관리):**

-   1열: 조리원 ID (예: 김철수조리원)
-   2열: PIN 번호
-   3열: 월 배정 금액 (기본값)
-   4열: 마스터 금액 (관리자 전용, 우선 적용)

**2번 시트 (Orders - 주문 내역):**

-   1열: 주문ID
-   2열: 조리원ID
-   3열: PIN
-   4열: 상품명
-   5열: 수량
-   6열: 단가
-   7열: 총액
-   8열: 날짜

## 🚀 배포 가이드

### 1단계: Google Sheets 설정

1. **새 Google Sheets 생성**

    - Google Drive에서 새 스프레드시트 생성
    - URL에서 스프레드시트 ID 복사 (예: `1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms`)

2. **시트 이름 설정**
    - 첫 번째 시트 이름을 "Users"로 변경
    - 두 번째 시트 이름을 "Orders"로 변경

### 2단계: Google Apps Script 설정

1. **Google Apps Script 접속**

    - [script.google.com](https://script.google.com) 접속
    - 새 프로젝트 생성

2. **코드 복사**

    - `google-apps-script.js` 파일의 내용을 복사
    - Google Apps Script 편집기에 붙여넣기

3. **스프레드시트 ID 설정**

    ```javascript
    const SPREADSHEET_ID = "여기에_실제_스프레드시트_ID_입력";
    ```

4. **테스트 실행**

    - `testSystem()` 함수 실행
    - 콘솔에서 "🎉 모든 테스트 통과!" 확인

5. **웹 앱 배포**
    - "배포" → "새 배포" 클릭
    - "유형 선택" → "웹 앱" 선택
    - "액세스 권한" → "모든 사용자" 선택
    - "배포" 클릭
    - 생성된 URL 복사

### 3단계: HTML 파일 설정

1. **API URL 설정**

    ```javascript
    const API_URL = "여기에_Google_Apps_Script_URL_입력";
    ```

2. **파일 업로드**
    - `index.html` 파일을 Netlify에 업로드
    - 또는 GitHub 저장소에 푸시 후 Netlify 연결

### 4단계: 사용자 데이터 입력

**Google Sheets 1번 시트 (Users)에 사용자 정보 입력:**

| 조리원ID     | PIN  | 월배정금액 | 마스터금액 |
| ------------ | ---- | ---------- | ---------- |
| 김철수조리원 | 1234 | 500000     |            |
| 이영희조리원 | 5678 | 600000     |            |
| 박민수조리원 | 9999 | 400000     |            |

## 💰 예산 관리 시스템

### 기본 예산 (3열)

-   각 조리원의 기본 월 배정 금액
-   매월 1일 자동으로 초기화

### 마스터 금액 (4열)

-   긴급 상황 시 관리자가 수동으로 입력
-   4열에 값이 있으면 3열 무시하고 4열 적용
-   다음달 1일 자동으로 삭제되어 3열로 복귀

### 예산 초과 방지

-   주문 시 실시간으로 예산 확인
-   예산 초과 시 주문 차단
-   남은 예산 실시간 표시

## 🔐 보안 기능

-   **PIN 이중 확인**: 주문 시 PIN 재입력
-   **사용자 인증**: 조리원ID + PIN 조합 검증
-   **예산 제한**: 월별 예산 초과 방지
-   **데이터 무결성**: Google Sheets로 안전한 데이터 관리

## 📱 사용법

### 조리원 사용법

1. **로그인**: 조리원ID와 PIN 입력
2. **상품 선택**: 원하는 상품과 수량 선택
3. **장바구니 확인**: 선택한 상품과 총 금액 확인
4. **주문하기**: PIN 재입력 후 주문 완료
5. **예산 확인**: 남은 예산 실시간 확인

### 관리자 기능

1. **사용자 관리**: Google Sheets에서 조리원 정보 관리
2. **예산 설정**: 3열에 기본 월 배정 금액 설정
3. **긴급 증액**: 4열에 마스터 금액 입력
4. **주문 내역**: 2번 시트에서 전체 주문 내역 확인

## 🔧 문제 해결

### API 연결 오류

-   Google Apps Script URL이 올바른지 확인
-   스프레드시트 ID가 정확한지 확인
-   웹 앱 배포 권한이 "모든 사용자"로 설정되었는지 확인

### 로그인 실패

-   조리원ID와 PIN이 Google Sheets에 정확히 입력되었는지 확인
-   대소문자 구분 확인

### 주문 실패

-   예산이 충분한지 확인
-   PIN 번호가 정확한지 확인

## 📞 지원

문제가 발생하면 다음을 확인해주세요:

1. 브라우저 콘솔에서 오류 메시지 확인
2. Google Apps Script 로그에서 서버 오류 확인
3. Google Sheets 데이터 구조 확인

---

**⚠️ 중요**: 실제 운영 전에 충분한 테스트를 진행하세요!

보안 관련 주의사항

1. 계정 관리
   ✅ PIN 번호: 개인별 고유 PIN 사용
   ✅ 계정 공유 금지: 다른 사람과 계정 공유하지 않기
   ✅ 로그아웃: 사용 후 반드시 로그아웃
2. 데이터 보안
   ✅ 민감 정보 보호: PIN, 예산 정보 외부 노출 금지
   ✅ 디버그 정보: 오류 메시지에 민감 정보 노출 방지됨
   📅 월별 관리 주의사항
3. 매월 1일 초기화
   ✅ 자동 초기화: 마스터 금액(4열) 자동 삭제
   ✅ 예산 재설정: 3열 월배정금액으로 복원
   ✅ 주문 내역: 당월 주문만 표시
4. 데이터 삭제 시점
   ⚠️ 삭제 전 확인: 매월 1일 초기화 완료 후 삭제
   ⚠️ 예산 확인: 새로운 월 예산 정상 적용 확인 후 삭제
   ⚠️ 백업 권장: 중요한 데이터는 삭제 전 백업
   💰 예산 관리 주의사항
5. 예산 우선순위
   1순위: 4열 마스터금액 (관리자 전용)
   2순위: 3열 월배정금액 (기본 예산)
   자동 초기화: 매월 1일 마스터금액 자동 삭제
6. 예산 계산 기준
   ✅ 한국 시간 기준: UTC+9 시간대 적용
   ✅ 당월 집계: 현재 월 주문만 예산 계산에 포함
   ✅ 실시간 업데이트: 주문 후 즉시 잔액 반영
   📦 주문 관리 주의사항
7. 배송 정보
   ✅ 자동 입력: 1번 시트의 배송지, 수취인, 연락처 자동 포함
   ✅ 정보 정확성: 배송 정보 정확히 입력 필요
   ✅ 주문 내역: 2번 시트에 모든 배송 정보 저장
8. 주문 제한
   ⚠️ 예산 초과: 월 예산 초과 시 주문 불가
   ⚠️ 수량 제한: 상품별 수량 제한 확인
   ⚠️ 주문 확인: 최종 주문 전 장바구니 재확인
   ��️ 시스템 관리 주의사항
9. Google Sheets 관리
   ✅ 시트 이름: 1번 시트 "Account", 2번 시트 "Orders"
   ✅ 헤더 유지: 시트 헤더 삭제 금지
   ✅ 데이터 구조: 열 순서 변경 금지
10. 시간대 설정
    ✅ 한국 시간: 모든 시간은 UTC+9 기준
    ✅ 월별 계산: 한국 시간 기준 월별 구분
    ✅ 초기화 시간: 매월 1일 00:00 한국 시간
    📊 데이터 관리 주의사항
11. 1번 시트 (Account)
    1열: 조리원ID
    2열: PIN
    3열: 월배정금액
    4열: 마스터금액 (관리자 전용)
    5열: 배송지
    6열: 수취인
    7열: 연락처
12. 2번 시트 (Orders)
    1열: 주문ID
    2열: 조리원ID
    3열: PIN
    4열: 상품명
    5열: 수량
    6열: 단가
    7열: 총액
    8열: 날짜
    9열: 배송지
    10열: 수취인
    11열: 연락처
    ⚠️ 긴급 상황 대처
13. 시스템 오류 시
    ✅ 로그 확인: 브라우저 개발자 도구 확인
    ✅ 재로그인: 세션 만료 시 재로그인
    ✅ 새로고침: 주문 내역 새로고침
14. 데이터 오류 시
    ✅ 예산 확인: 1번 시트 예산 정보 확인
    ✅ 주문 내역 확인: 2번 시트 주문 데이터 확인
    ✅ 시간대 확인: 한국 시간 기준 확인
    �� 최적 사용법
15. 일상 사용
    ✅ 정기 로그인: 주기적으로 시스템 확인
    ✅ 예산 모니터링: 월별 예산 사용량 확인
    ✅ 주문 내역 확인: 이번달 주문 내역 정기 확인
16. 관리자 기능
    ✅ 마스터 금액: 긴급 시에만 4열 사용
    ✅ 데이터 백업: 정기적인 데이터 백업
    ✅ 시스템 모니터링: 월별 초기화 정상 작동 확인

✅ 정상 작동 확인 사항들:

1. 보안 관련 ✅
   ✅ 민감 정보 보호: PIN, 예산 정보 노출 방지됨
   ✅ 오류 메시지: 일반적인 오류 메시지만 표시
   ✅ 인증 시스템: 조리원ID + PIN 조합 검증
2. 시간대 처리 ✅
   ✅ 한국 시간 기준: 모든 시간이 UTC+9로 처리
   ✅ 월별 계산: 정확한 월별 예산 계산
   ✅ 주문 내역: 한국 시간으로 표시
   ✅ 자동 초기화: 매월 1일 한국 시간 기준
3. 예산 관리 ✅
   ✅ 마스터 금액 우선: 4열 우선 적용
   ✅ 자동 초기화: 매월 1일 4열 자동 삭제
   ✅ 실시간 계산: 주문 후 즉시 잔액 반영
   ✅ 예산 초과 방지: 초과 시 주문 차단
4. 주문 시스템 ✅
   ✅ 배송 정보: 자동으로 배송지, 수취인, 연락처 포함
   ✅ 당월 필터링: 이번달 주문 내역만 표시
   ✅ 아코디언 UI: 깔끔한 주문 내역 표시
   ✅ 장바구니: 수량 조절 및 총액 계산
5. 데이터 구조 ✅
   ✅ 1번 시트 (Account): 7열 구조 완벽
   ✅ 2번 시트 (Orders): 11열 구조 완벽
   ✅ 헤더 설정: 자동 헤더 생성 및 스타일링
   ✅ 데이터 검증: 입력값 검증 및 오류 처리
6. 사용자 경험 ✅
   ✅ 반응형 디자인: 모바일 친화적
   ✅ 로딩 상태: 적절한 로딩 메시지
   ✅ 오류 처리: 명확한 오류 메시지
   ✅ 직관적 UI: 사용하기 쉬운 인터페이스
7. API 통신 ✅
   ✅ CORS 지원: 크로스 도메인 통신
   ✅ JSONP 지원: 다양한 호스팅 환경 지원
   ✅ 에러 핸들링: 네트워크 오류 처리
   ✅ 응답 검증: API 응답 상태 확인
   🎯 결론:
   모든 기능이 정상적으로 구현되어 있고, 보안, 시간대, 예산 관리, 주문 시스템 등 모든 요구사항이 완벽하게 충족되었습니다!시스템이 완전히 준비되었으니 바로 사용하실 수 있습니다! 🚀
