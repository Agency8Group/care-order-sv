# 조리원 주문 시스템 - 개발 전달사항

## 📋 프로젝트 개요

**프로젝트명**: 조리원 주문 시스템  
**개발 기간**: 2025년 8월  
**개발자**: 지윤환  
**상태**: 완료 (배포 준비 완료)

## 🎯 시스템 요구사항

### 핵심 기능

1. **사용자 인증**: 조리원ID + PIN 로그인
2. **예산 관리**: 월별 예산, 마스터 예산, 자동 초기화
3. **주문 처리**: 장바구니, 예산 초과 방지, 배송 정보
4. **주문 내역**: 당월 주문 내역 조회 (아코디언 UI)
5. **시간대 처리**: 한국 시간(UTC+9) 기준

### 기술 스택

-   **백엔드**: Google Apps Script (JavaScript)
-   **프론트엔드**: HTML5, CSS3, JavaScript (ES6+)
-   **데이터베이스**: Google Sheets
-   **배포**: Google Apps Script 웹앱 + 정적 호스팅

## 📁 파일 구조

```
주문시스템/
├── google-apps-script.js    # 백엔드 API 서버
├── index.html              # 프론트엔드 UI
├── README.md               # 사용자 가이드
├── TECHNICAL_DOCUMENTATION.md  # 기술 문서
└── 개발_전달사항.md        # 이 문서
```

## 🔧 구현된 기능

### 1. 사용자 인증 시스템

-   **조리원ID + PIN 조합 검증**
-   **Account 시트 1열(ID), 2열(PIN) 매칭**
-   **보안 강화**: 민감 정보 노출 방지
-   **세션 관리**: 로그인/로그아웃 처리

### 2. 예산 관리 시스템

-   **기본 예산**: 3열 월배정금액
-   **마스터 예산**: 4열 마스터금액 (우선 적용)
-   **자동 초기화**: 매월 1일 4열 자동 삭제
-   **실시간 계산**: 주문 시 즉시 잔액 업데이트
-   **예산 초과 방지**: 주문 차단 기능

### 3. 주문 처리 시스템

-   **장바구니 기능**: 수량 조절, 총액 계산
-   **배송 정보**: 자동으로 배송지, 수취인, 연락처 포함
-   **주문 내역 저장**: Orders 시트에 상세 정보 저장
-   **주문 완료 후**: 잔액 표시, 장바구니 초기화

### 4. 시간대 처리

-   **한국 시간 기준**: 모든 시간 UTC+9 처리
-   **월별 계산**: 정확한 월별 예산 계산
-   **매월 1일 초기화**: 정확한 시간 기준 초기화

### 5. UI/UX 개선

-   **반응형 디자인**: 모바일 친화적
-   **아코디언 UI**: 주문 내역 접기/펼치기
-   **사용자 친화적**: 직관적인 인터페이스
-   **오류 처리**: 명확한 오류 메시지

## 📊 데이터베이스 구조

### Account 시트 (1번 시트)

| 열  | 필드명     | 타입   | 설명                    |
| --- | ---------- | ------ | ----------------------- |
| 1   | 조리원ID   | String | 고유 식별자             |
| 2   | PIN        | String | 인증 번호               |
| 3   | 월배정금액 | Number | 기본 월 예산            |
| 4   | 마스터금액 | Number | 관리자 전용 예산 (우선) |
| 5   | 배송지     | String | 기본 배송 주소          |
| 6   | 수취인     | String | 수취인 이름             |
| 7   | 연락처     | String | 연락처 정보             |

### Orders 시트 (2번 시트)

| 열  | 필드명   | 타입     | 설명                  |
| --- | -------- | -------- | --------------------- |
| 1   | 주문ID   | String   | 고유 주문 번호        |
| 2   | 조리원ID | String   | 주문자 식별자         |
| 3   | PIN      | String   | 주문 시점 PIN         |
| 4   | 상품명   | String   | 주문 상품명           |
| 5   | 수량     | Number   | 주문 수량             |
| 6   | 단가     | Number   | 상품 단가             |
| 7   | 총액     | Number   | 수량 × 단가           |
| 8   | 날짜     | DateTime | 주문 일시 (한국 시간) |
| 9   | 배송지   | String   | 배송 주소             |
| 10  | 수취인   | String   | 수취인 이름           |
| 11  | 연락처   | String   | 연락처 정보           |

## 🔌 API 엔드포인트

### 1. 로그인 (action=login)

```javascript
// 요청
{
  "userId": "조리원ID",
  "pin": "PIN번호"
}

// 응답
{
  "status": "success",
  "user": {
    "userId": "조리원ID",
    "pin": "PIN번호",
    "monthlyBudget": 100000,
    "masterBudget": null,
    "deliveryAddress": "배송지",
    "recipient": "수취인",
    "phone": "연락처"
  },
  "budget": {
    "totalBudget": 100000,
    "monthlyTotal": 0,
    "remainingBudget": 100000,
    "isMasterBudget": false,
    "monthlyBudget": 100000,
    "masterBudget": null
  }
}
```

### 2. 주문 처리 (action=order)

```javascript
// 요청
{
  "userId": "조리원ID",
  "pin": "PIN번호",
  "items": [
    {
      "name": "상품명",
      "quantity": 2,
      "price": 10000
    }
  ]
}

// 응답
{
  "status": "success",
  "order": {
    "orderId": "order_1234567890_abc123",
    "userId": "조리원ID",
    "items": [...],
    "totalAmount": 20000,
    "timestamp": "2025-01-XXTXX:XX:XX+09:00"
  },
  "remainingBudget": 80000,
  "budgetInfo": {...}
}
```

### 3. 주문 내역 조회 (action=getOrders)

```javascript
// 요청
{
  "userId": "조리원ID"  // 선택사항
}

// 응답
{
  "status": "success",
  "orders": [
    {
      "orderId": "order_1234567890_abc123",
      "userId": "조리원ID",
      "pin": "PIN번호",
      "itemName": "상품명",
      "quantity": 2,
      "price": 10000,
      "total": 20000,
      "timestamp": "2025-01-XXTXX:XX:XX+09:00",
      "deliveryAddress": "배송지",
      "recipient": "수취인",
      "phone": "연락처"
    }
  ]
}
```

### 4. 예산 정보 조회 (action=getBudget)

```javascript
// 요청
{
  "userId": "조리원ID"
}

// 응답
{
  "status": "success",
  "budget": {
    "totalBudget": 100000,
    "monthlyTotal": 20000,
    "remainingBudget": 80000,
    "isMasterBudget": false,
    "monthlyBudget": 100000,
    "masterBudget": null
  }
}
```

## 🛠️ 핵심 함수들

### Google Apps Script (google-apps-script.js)

#### 1. 사용자 인증

```javascript
function authenticateUser(data)
function getUserById(userId)
```

#### 2. 주문 처리

```javascript
function processOrder(data)
function generateOrderId()
```

#### 3. 예산 계산

```javascript
function calculateCurrentBudget(user)
function getBudgetInfo(data)
```

#### 4. 주문 내역

```javascript
function getOrders(data)
```

#### 5. 시간대 처리

```javascript
function getKoreanTime()
function autoResetMasterBudget()
```

#### 6. 시트 관리

```javascript
function getUserSheet()
function getOrderSheet()
function setupUserSheet(sheet)
function setupOrderSheet(sheet)
```

### HTML/JavaScript (index.html)

#### 1. 인증 관련

```javascript
function handleLogin()
function handleLogout()
function showMainSection()
function showLoginSection()
```

#### 2. 주문 관련

```javascript
function handleOrder()
function updateCart()
function clearCart()
function increaseQuantity(productId)
function decreaseQuantity(productId)
function updateQuantity(productId)
```

#### 3. UI 관련

```javascript
function renderProducts()
function renderOrderHistory(orders)
function updateBudgetInfo(budget)
function showMessage(text, type, elementId)
function toggleOrderHistory()
```

## 🚀 배포 방법

### 1. Google Apps Script 설정

1. Google Apps Script 프로젝트 생성
2. `google-apps-script.js` 코드 복사
3. `SPREADSHEET_ID` 실제 값으로 변경
4. `testSystem()` 함수 실행하여 테스트
5. 웹 앱으로 배포 (액세스 권한: 모든 사용자)

### 2. HTML 파일 설정

1. `index.html` 파일 준비
2. `API_URL` 실제 배포 URL로 변경
3. 정적 웹 호스팅 서비스에 업로드 (Netlify 등)

### 3. Google Sheets 설정

1. 새 Google Sheets 생성
2. 시트 이름을 "Account", "Orders"로 설정
3. 헤더 행 자동 생성됨

## 🔒 보안 고려사항

### 1. 데이터 보호

-   ✅ 민감 정보(PIN, 예산) 노출 방지
-   ✅ 일반적인 오류 메시지만 표시
-   ✅ 디버그 정보 제거

### 2. 인증 보안

-   ✅ 조리원ID + PIN 이중 검증
-   ✅ 세션 기반 인증
-   ✅ 로그아웃 시 세션 클리어

### 3. 입력 검증

-   ✅ 모든 입력값 검증
-   ✅ SQL Injection 방지
-   ✅ XSS 공격 방지

## 🐛 해결된 문제들

### 1. 로그인 문제

-   **문제**: PIN/ID 불일치 오류
-   **원인**: 쉼표가 포함된 예산 데이터, 시트 이름 불일치, PIN 타입 불일치
-   **해결**: 쉼표 제거 로직, 시트 이름 수정, 문자열 변환

### 2. 시간대 문제

-   **문제**: UTC 시간과 한국 시간 불일치
-   **원인**: Google Apps Script 기본 UTC 시간
-   **해결**: `getKoreanTime()` 함수 구현, 모든 시간 한국 시간 기준 처리

### 3. 보안 문제

-   **문제**: 민감 정보 노출
-   **원인**: 디버그 정보에 PIN, 예산 정보 포함
-   **해결**: 디버그 정보 완전 제거, 일반적인 오류 메시지만 표시

### 4. UI 문제

-   **문제**: 주문 내역이 너무 길어짐
-   **해결**: 아코디언 UI 구현, 기본적으로 접혀있음

## 📝 상품 목록

현재 구현된 상품 목록 (index.html의 products 배열):

```javascript
let products = [
    { id: 1, name: "배냇저고리", price: 2800, unit: "1ea" },
    { id: 2, name: "속싸개", price: 4000, unit: "1ea" },
    { id: 3, name: "엠보 손수건", price: 36300, unit: "100ea" },
    { id: 4, name: "엠보 나염 손수건", price: 3900, unit: "10ea" },
    {
        id: 5,
        name: "스마트 8종 세트 (저고리/턱받이/손수건/손싸개/발싸개/겉싸개/모자/미니방수패드)",
        price: 27500,
        unit: "1ea",
    },
    { id: 6, name: "스와들", price: 13800, unit: "1ea" },
    { id: 7, name: "블랭킷", price: 12100, unit: "1ea" },
    {
        id: 8,
        name: "하기스 네이처메이드 1단계 공용",
        price: 48000,
        unit: "1box (198ea)",
    },
    { id: 9, name: "네임카드 핑크", price: 5000, unit: "100ea" },
    { id: 10, name: "네임카드 블루", price: 5000, unit: "100ea" },
    { id: 11, name: "산모용 팔찌", price: 6100, unit: "20ea" },
    { id: 12, name: "신생아용 팔찌 핑크", price: 6100, unit: "20ea" },
    { id: 13, name: "신생아용 팔찌 블루", price: 6100, unit: "20ea" },
    {
        id: 14,
        name: "정식품 베지밀 달콤한 비 두유",
        price: 44800,
        unit: "1box (64ea)",
    },
];
```

## 🔄 자동화 기능

### 1. 매월 1일 자동 초기화

```javascript
function autoResetMasterBudget()
```

-   **기능**: 매월 1일 4열(마스터금액) 자동 삭제
-   **설정**: Google Apps Script 트리거 설정 필요
-   **시간**: 한국 시간 기준 00:00

### 2. 시트 자동 생성

```javascript
function getUserSheet()
function getOrderSheet()
```

-   **기능**: 시트가 없으면 자동 생성
-   **헤더**: 자동으로 헤더 행 생성 및 스타일링

## 📋 테스트 방법

### 1. 시스템 테스트

```javascript
function testSystem()
```

-   시트 접근 테스트
-   인증 테스트
-   예산 계산 테스트

### 2. 수동 테스트

1. 로그인 테스트 (올바른/잘못된 정보)
2. 주문 테스트 (예산 내/초과)
3. 주문 내역 조회 테스트
4. 예산 정보 조회 테스트

## 🚨 주의사항

### 1. 데이터 관리

-   **매월 1일**: 자동 초기화 후 데이터 삭제 권장
-   **백업**: 정기적인 Google Sheets 백업
-   **권한**: Google Sheets 접근 권한 확인

### 2. 시간대 처리

-   **모든 시간**: 한국 시간(UTC+9) 기준
-   **월별 계산**: 정확한 월별 구분
-   **초기화**: 매월 1일 00:00 정확한 초기화

### 3. 보안

-   **PIN 관리**: 안전한 PIN 관리
-   **세션**: 사용 후 로그아웃
-   **접근 권한**: Google Sheets 권한 설정

## 🔮 향후 개선 가능한 기능

### 1. 기능 개선

-   관리자 대시보드 추가
-   통계 리포트 기능
-   알림 시스템 구현
-   상품 관리 시스템

### 2. 성능 개선

-   캐싱 시스템 도입
-   데이터베이스 최적화
-   API 응답 속도 개선

### 3. 보안 강화

-   2단계 인증 도입
-   데이터 암호화
-   접근 로그 관리

## 📞 연락처

**개발자**: 지윤환  
**문서 작성일**: 2025년 1월  
**프로젝트 상태**: 완료

---

**이 문서를 참고하여 다음 개발자가 시스템을 이해하고 유지보수할 수 있습니다.**
